<!DOCTYPE html>
<html>
<head>
  <title>Dynamic Form</title>
  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

</head>
<body>
  <h1 id="form-title"></h1>
  <form id="dynamic-form"></form>
  <button type="submit" form="dynamic-form">Submit</button>

  <script>
    const FORM_API_URL = 'http://127.0.0.1:8000/api/forms/1/';

    axios.get(FORM_API_URL)
      .then(response => {
        const form = response.data;
        document.getElementById('form-title').textContent = form.title;

        const formEl = document.getElementById('dynamic-form');

        form.fields.forEach(field => {
          const wrapper = document.createElement('div');

          const label = document.createElement('label');
          label.textContent = field.label;
          label.htmlFor = `field-${field.id}`;
          wrapper.appendChild(label);

          let input;
          if (field.type === 'select') {
            input = document.createElement('select');
            const defaultOption = document.createElement('option');
            defaultOption.value = '';
            defaultOption.text = '-- Select --';
            input.appendChild(defaultOption);

            (field.options || []).forEach(opt => {
              const option = document.createElement('option');
              option.value = opt;
              option.text = opt;
              input.appendChild(option);
            });
          } else {
            input = document.createElement('input');
            input.type = field.type;
            if (field.regex_validation) input.pattern = field.regex_validation;
            if (field.placeholder) input.placeholder = field.placeholder;
          }

          input.id = `field-${field.id}`;
          input.name = `field_${field.id}`;
          input.required = field.required;

          wrapper.appendChild(input);
          formEl.appendChild(wrapper);
        });
      })
      .catch(error => {
        console.error('Failed to fetch form:', error);
      });

    document.getElementById('dynamic-form').addEventListener('submit', function (e) {
      e.preventDefault();
      const formData = new FormData(e.target);
      const payload = {};
      for (const [key, value] of formData.entries()) {
        payload[key] = value;
      }
      console.log('Form submitted:', payload);

      axios.post('http://localhost:8000/api/forms/1/post-response/', payload)
        .then(res => console.log('Submitted successfully', res.data))
        .catch(err => console.error('Submission error', err));
    });
  </script>
</body>
</html>
